---
title: "stats170"
author: "shoichiro ueno"
date: "2023-01-26"
output: html_document
---


```{r}
library(Quandl)
library(dygraphs)
Quandl.api_key("") 
```


```{r data}
retails = Quandl(code="FRED/RSXFSN",
            type="ts",
            collapse="monthly",
            meta=TRUE)

# Do not include 2020 and 2021 years in your data
retails = window(retails, end = c(2019, 12))
```

```{r}
sum(is.na(retails))
```


```{r dygraph}
retails %>% 
  dygraph() %>% 
  dyRangeSelector
```

```{r test data}
retails_train = retails %>% 
  window(end = c(2017, 12))

retails_test = retails %>% 
  window(start = 2018)
```


```{r decomposition}
plot(decompose(retails_train))

plot(decompose(retails_train, type = "mult"))
```

```{r seasonal boxplot}
# there is no sasonal effect quarterly
boxplot(retails_train ~ cycle(retails_train))
```
```{r variance}
plot(retails_train)
```
```{r }
# This is saying that the data is not stationary
acf(retails_train)
```

```{r transformation can help stabilise the variance of time series}
log_data = log(retails_train)

quadratic_data = retails_train^2

squared_data = sqrt(retails_train)

par(mfrow = c(3, 1))
plot(log_data, main = "log") 
plot(quadratic_data, main = "quadratic")
plot(squared_data, main = "squared")
```
```{r diffirence can help stabilise the mean of time series}
lagged = diff(log_data)
plot(lagged) # now it is a mean of zero and has a constant variance

acf(lagged)
```


```{r model}
HoltWinters(lagged, beta = FALSE, gamma = FALSE)
```

