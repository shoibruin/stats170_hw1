---
title: "stats170"
author: "shoichiro ueno"
date: "2023-01-26"
output: html_document
---


```{r}
library(Quandl)
library(dygraphs)
Quandl.api_key("") 
```


```{r data}
retails = Quandl(code="FRED/RSXFSN",
            type="ts",
            collapse="monthly",
            meta=TRUE)

# Do not include 2020 and 2021 years in your data
retails = window(retails, end = c(2019, 12))
```

```{r}
retails_elecronic = Quandl(code="FRED/RSXFSN",
            type="ts",
            collapse="monthly",
            meta=TRUE)

retails_hobby = Quandl(code="FRED/RSSGHBMS",
            type="ts",
            collapse="monthly",
            meta=TRUE)

retails_furniture = Quandl(code="FRED/RSFHFS",
            type="ts",
            collapse="monthly",
            meta=TRUE)
```


```{r}
sum(is.na(retails_elecronic))
sum(is.na(retails_hobby))
sum(is.na(retails_furniture))
```


```{r dygraph}
retails_elecronic %>% 
  dygraph() %>% 
  dyRangeSelector

retails_hobby %>% 
  dygraph() %>% 
  dyRangeSelector

retails_furniture %>% 
  dygraph() %>% 
  dyRangeSelector()
```

```{r test data}
retails_electronic_train = retails_elecronic %>% 
  window(end = c(2017, 12))

retails_elecronic_test = retails_elecronic %>% 
  window(start = 2018)

retails_hobby_train = retails_hobby %>% 
  window(end = c(2017, 12))

retails_hobby_test = retails_hobby %>% 
  window(start = 2018)

retails_furniture_train = retails_furniture %>% 
  window(end = c(2017, 12))

retails_furniture_test = retails_furniture %>% 
  window(start = 2018)
```


```{r decomposition additive}
plot(decompose(retails_electronic_train))

plot(decompose(retails_hobby_train))

plot(decompose(retails_furniture_train))
```

```{r decomposition mult}
plot(decompose(retails_electronic_train, type = "mult"))

plot(decompose(retails_hobby_train, type = "mult"))

plot(decompose(retails_furniture_train, type = "mult"))
```


```{r seasonal boxplot}
boxplot(retails_electronic_train ~ cycle(retails_electronic_train))

boxplot(retails_hobby_train ~ cycle(retails_hobby_train))

boxplot(retails_furniture_train ~ cycle(retails_furniture_train))

```

```{r }
acf(retails_electronic_train)
acf(retails_hobby_train)
acf(retails_furniture_train)
```

```{r transformation can help stabilise the variance of time series}
retails_electronic_train_log = log(retails_electronic_train)

retails_electronic_train_quadratic = retails_electronic_train^2

retails_electronic_train_squared = sqrt(retails_electronic_train)

par(mfrow = c(3, 1))
plot(retails_electronic_train_log, main = "log") 
plot(retails_electronic_train_quadratic, main = "quadratic")
plot(retails_electronic_train_squared, main = "squared")
```
```{r diffirence can help stabilise the mean of time series}
squared_data = diff(retails_electronic_train_squared)
plot(squared_data) # now it is a mean of zero and has a constant variance

acf(squared_data)
```


```{r model}
HoltWinters(squared_data, beta = FALSE, gamma = FALSE)
```

